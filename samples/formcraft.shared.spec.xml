<?xml version="1.0" encoding="UTF-8"?>
<!--
  FormCraft - Shared Definitions

  Contains entities and reusable components shared across all platform specs:
  - formcraft.webapp.spec.xml (web version)
  - formcraft.mobile.spec.xml (mobile version)
  - formcraft.desktop.spec.xml (desktop version)
-->
<spec type="shared" name="FormCraft">

  <!-- ==================== ENTITIES ==================== -->
  <entities>
    <entity name="User">
      <field name="id" type="uuid" />
      <field name="email" type="email" prompt="required" />
      <field name="name" type="string" prompt="required" />
      <field name="avatar" type="image" />
      <field name="plan" type="enum" prompt="values free, pro, enterprise; default free" />
      <field name="createdAt" type="datetime" />
      <field name="forms" type="ref" prompt="references @entity.Form, many" />
      <field name="apiKeys" type="ref" prompt="references @entity.ApiKey, many" />
    </entity>

    <entity name="Form">
      <field name="id" type="uuid" />
      <field name="name" type="string" prompt="required" />
      <field name="description" type="text" />
      <field name="slug" type="string" prompt="unique" />
      <field name="fields" type="ref" prompt="references @entity.FormField, many, ordered" />
      <field name="settings" type="ref" prompt="references @entity.FormSettings, one" />
      <field name="owner" type="ref" prompt="references @entity.User, one" />
      <field name="submissions" type="ref" prompt="references @entity.Submission, many" />
      <field name="status" type="enum" prompt="values draft, published, archived; default draft" />
      <field name="createdAt" type="datetime" />
      <field name="updatedAt" type="datetime" />
      <field name="publishedAt" type="datetime" />
    </entity>

    <entity name="FormField">
      <field name="id" type="uuid" />
      <field name="type" type="enum" prompt="values text, email, number, phone, textarea, select, radio, checkbox, date, time, file, signature, rating, hidden" />
      <field name="label" type="string" prompt="required" />
      <field name="placeholder" type="string" />
      <field name="helpText" type="string" />
      <field name="required" type="boolean" prompt="default false" />
      <field name="validation" type="json" />
      <field name="options" type="json" />
      <field name="conditionalLogic" type="json" />
      <field name="order" type="integer" />
    </entity>

    <entity name="FormSettings">
      <field name="id" type="uuid" />
      <field name="submitButtonText" type="string" prompt="default Submit" />
      <field name="successMessage" type="text" />
      <field name="redirectUrl" type="url" />
      <field name="notifyEmail" type="email" />
      <field name="enableCaptcha" type="boolean" prompt="default false" />
      <field name="allowMultipleSubmissions" type="boolean" prompt="default true" />
      <field name="closeAfterDate" type="datetime" />
      <field name="maxSubmissions" type="integer" />
      <field name="customCss" type="text" />
      <field name="webhookUrl" type="url" />
    </entity>

    <entity name="Submission">
      <field name="id" type="uuid" />
      <field name="form" type="ref" prompt="references @entity.Form" />
      <field name="data" type="json" />
      <field name="metadata" type="json" />
      <field name="ipAddress" type="string" />
      <field name="userAgent" type="string" />
      <field name="createdAt" type="datetime" />
      <field name="isRead" type="boolean" prompt="default false" />
      <field name="isSpam" type="boolean" prompt="default false" />
    </entity>

    <entity name="ApiKey">
      <field name="id" type="uuid" />
      <field name="name" type="string" prompt="required" />
      <field name="key" type="string" />
      <field name="permissions" type="enum" prompt="values read, write, admin" />
      <field name="lastUsedAt" type="datetime" />
      <field name="createdAt" type="datetime" />
    </entity>
  </entities>


  <!-- ==================== GUARDS ==================== -->
  <guards>
    <guard name="auth" prompt="if not authenticated, redirect to login" />
    <guard name="admin" prompt="if not admin role, redirect to unauthorized" />
    <guard name="owner" prompt="if not resource owner, redirect to unauthorized" />
  </guards>


  <!-- ==================== ACTIONS ==================== -->
  <actions>
    <action name="save" prompt="submit form, show success toast" />
    <action name="delete" prompt="confirm dialog, delete item, refresh list" />
    <action name="duplicate" prompt="duplicate item, navigate to new item" />
    <action name="share" prompt="open share dialog with link and embed options" />
    <action name="export" prompt="download data as selected format" />
    <action name="logout" prompt="clear session, redirect to login" />
  </actions>


  <!-- ==================== SHARED COMPONENTS ==================== -->
  <components>

    <!-- Avatar Component -->
    <component name="Avatar">
      <props>
        <prop name="src" type="image" />
        <prop name="name" type="string" />
        <prop name="size" type="enum" prompt="values xs, sm, md, lg, xl; default md" />
      </props>
      <prompt>
        Circular avatar image with fallback to initials.
        Sizes: xs=20px, sm=28px, md=36px, lg=48px, xl=64px.
        If no src, show first two initials on colored background.
        Color should be deterministic based on name.
      </prompt>
    </component>


    <!-- Form Card for Lists -->
    <component name="FormCard">
      <props>
        <prop name="form" type="@entity.Form" prompt="required" />
      </props>

      <container type="column" prompt="padding medium, background white, border radius medium, shadow small, interactive">
        <container type="row" prompt="justify between, align start">
          <container type="column" prompt="gap extra-small">
            <element type="text" prompt="subtitle, weight medium" use="@prop.form.name" />
            <element type="text" prompt="caption, muted, truncate 2 lines" use="@prop.form.description" />
          </container>
        </container>

        <container type="row" prompt="gap medium, margin top medium">
          <element type="badge" prompt="file-text icon">{@prop.form.fields.length} fields</element>
          <element type="badge" prompt="inbox icon">{@prop.form.submissions.length} responses</element>
          <element type="badge" use="@prop.form.status" />
        </container>

        <container type="row" prompt="justify between, align center, margin top medium">
          <element type="text" prompt="caption, muted">
            Updated {formatRelative(@prop.form.updatedAt)}
          </element>
        </container>
      </container>
    </component>


    <!-- Stat Card -->
    <component name="StatCard">
      <props>
        <prop name="label" type="string" prompt="required" />
        <prop name="value" type="number" prompt="required" />
        <prop name="icon" type="string" />
        <prop name="trend" type="number" />
        <prop name="trendLabel" type="string" />
        <prop name="compact" type="boolean" prompt="default false" />
      </props>

      <container type="column" prompt="padding large, background white, border radius medium, shadow small">
        <container type="row" prompt="justify between, align center">
          <element type="text" prompt="caption, muted" use="@prop.label" />
          <element type="icon" use="@prop.icon" prompt="size small, muted" if="@prop.icon" />
        </container>
        <element type="text" prompt="heading2" use="@prop.value" />
        <container type="row" prompt="gap extra-small, align center" if="@prop.trend">
          <element type="icon" prompt="size extra-small, color success if positive else danger" use="{@prop.trend > 0 ? 'trending-up' : 'trending-down'}" />
          <element type="text" prompt="caption, color success if positive else danger">{Math.abs(@prop.trend)}%</element>
          <element type="text" prompt="caption, muted" use="@prop.trendLabel" />
        </container>
      </container>
    </component>


    <!-- Empty State -->
    <component name="EmptyState">
      <props>
        <prop name="icon" type="string" prompt="default inbox" />
        <prop name="title" type="string" prompt="required" />
        <prop name="description" type="string" />
        <prop name="actionLabel" type="string" />
      </props>

      <container type="column" prompt="align center, gap medium, padding extra-large">
        <container type="row" prompt="center, width 64px, height 64px, border radius full, background gray-100">
          <element type="icon" use="@prop.icon" prompt="size large, muted" />
        </container>
        <element type="text" prompt="heading3, align center" use="@prop.title" />
        <element type="text" prompt="body, muted, align center, max width 300px" use="@prop.description" if="@prop.description" />
        <element type="button" prompt="style primary, on click @action.onAction" if="@prop.actionLabel">{@prop.actionLabel}</element>
      </container>
    </component>


    <!-- Submission Row -->
    <component name="SubmissionRow">
      <props>
        <prop name="submission" type="@entity.Submission" prompt="required" />
      </props>

      <container type="row" prompt="padding small, gap medium, align center, interactive">
        <container prompt="width 8px, height 8px, border radius full, background primary" if-not="@prop.submission.isRead" />
        <container type="column" prompt="grow, gap extra-small">
          <element type="text" prompt="body, weight medium" use="@prop.submission.form.name" />
          <element type="text" prompt="caption, muted">{summarize(@prop.submission.data, 50)}</element>
        </container>
        <element type="text" prompt="caption, muted, format relative" use="@prop.submission.createdAt" />
      </container>
    </component>

  </components>


  <!-- ==================== THEME ==================== -->
  <config>
    <theme>
      <value type="color" name="primary">#6366F1</value>
      <value type="color" name="secondary">#8B5CF6</value>
      <value type="color" name="success">#10B981</value>
      <value type="color" name="warning">#F59E0B</value>
      <value type="color" name="danger">#EF4444</value>
      <value type="color" name="muted">#6B7280</value>
      <value type="color" name="gray.50">#F9FAFB</value>
      <value type="color" name="gray.100">#F3F4F6</value>
      <value type="color" name="gray.200">#E5E7EB</value>
      <value type="color" name="gray.300">#D1D5DB</value>
      <value type="color" name="gray.400">#9CA3AF</value>
      <value type="color" name="gray.500">#6B7280</value>
      <value type="color" name="gray.600">#4B5563</value>
      <value type="color" name="gray.700">#374151</value>
      <value type="color" name="gray.800">#1F2937</value>
      <value type="color" name="gray.900">#111827</value>
      <value type="spacing" name="unit">4px</value>
      <value type="radius" name="default">8px</value>
    </theme>
  </config>

</spec>
